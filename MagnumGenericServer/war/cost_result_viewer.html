
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>ROAR Viewer</title>
	<link href="css/examples.css" rel="stylesheet" type="text/css">
	<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="../../excanvas.min.js"></script><![endif]-->
	<script language="javascript" type="text/javascript" src="js/jquery.js"></script>
	<script language="javascript" type="text/javascript" src="js/jquery.flot.js"></script>
	<script language="javascript" type="text/javascript" src="js/jquery.flot.symbol.js"></script>
	<script type="text/javascript">

	var QueryString = function () {
	    // This function is anonymous, is executed immediately and 
	    // the return value is assigned to QueryString!
	    var query_string = {};
	    var query = window.location.search.substring(1);
	    var vars = query.split("&");
	    for (var i=0;i<vars.length;i++) {
	        var pair = vars[i].split("=");
	    	// If first entry with this name
		    if (typeof query_string[pair[0]] === "undefined") {
		        query_string[pair[0]] = pair[1];
		    	// If second entry with this name
		    } else if (typeof query_string[pair[0]] === "string") {
	        var arr = [ query_string[pair[0]], pair[1] ];
	        query_string[pair[0]] = arr;
	    	// If third or later entry with this name
		    } else {
		      query_string[pair[0]].push(pair[1]);
		    }
	    } 
	    return query_string;
	} ();

	$(function () {		
		var resultUrl = "https://s3.amazonaws.com/roar-tests/" + QueryString.testId + "/throughput-perm-processed.json";
		var instanceType = QueryString.type;
		var app = QueryString.app;
		if (instanceType != null && app != null) {
		    $('#details').html('Container: ' + app + ' &nbsp;&nbsp; Instance Type: ' + instanceType);	
		}

		$("<div id='tooltip'></div>").css({
				position: "absolute",
				display: "none",
				border: "1px solid #fdd",
				padding: "2px",
				"background-color": "#fee",
				opacity: 0.80
			}).appendTo("body");
		
		$.getJSON("http://yu-tmp.s3.amazonaws.com/cost.json" , function( data ) {
			
			// draw throughput chart			
			var opt = [];			
			var worst = [];
			var prac = [];
			var s1 = [];			
			var s2 = [];
			var s3 = [];
			var s4 = [];
			var total = 0;
		    var good = 0;
		    
			$.each( data, function( index, value ) {
				console.log("test: " + index + " count: " + value.s1 + " label(sec): " + value.s2);

 				opt.push([value.optimal, value.optimal]);
				worst.push([value.optimal, value.worst]);
				prac.push([value.optimal, value.practical]);

				s1.push([value.optimal, value.s1]);
				s2.push([value.optimal, value.s2]);
				s3.push([value.optimal, value.s3]);
				s4.push([value.optimal, value.s4]);

			    total += (value.worst - value.s1) / value.s1;
			    if (value.s3 < value.s1) good++;
				 /* opt.push([index, value.optimal]);
				 worst.push([index, value.worst]);
				 prac.push([index, value.practical]);

				 s1.push([index, value.s1]);
				 s2.push([index, value.s2]);
				 s3.push([index, value.s3]); */

				// perfData.push([parseInt(value.label), value.count]);
				// errorCountData.push([parseInt(value.label), value.errorCount]);
				// avgLatencyData.push([parseInt(value.label), value.mean]);
			});
			
			console.log("final " + total / 100);
			console.log("good " + good);
		
			opt.sort(function(a,b){return a[0]-b[0]});
			worst.sort(function(a,b){return a[0]-b[0]});
			prac.sort(function(a,b){return a[0]-b[0]});
			s1.sort(function(a,b){return a[0]-b[0]});
			s2.sort(function(a,b){return a[0]-b[0]});
			s3.sort(function(a,b){return a[0]-b[0]});
			s4.sort(function(a,b){return a[0]-b[0]});

			$.plot("#throughput-chart", [
				//{ label: "Practically Optimal (Without Co-location)", data: prac, color: 1 },
				//{ label: "Least Optimal", data: worst, color: 2 },				
				//{ label: "Most Optimal", data: opt , color: 0},				
				
				  // { label: "C2RAM - Sorting by Biggest Item", data: s2, color: 12 },
				  //{ label: "C2RAM - No Item Sorting", data: s3, color: 4},
				  { label: "C2RAM (11 EC2 Types)", data: s3, color: 3 },
				 { label: "C2RAM (11 EC2 Types + 8 GCE Types)", data: s4, color: 7 },
				], {
					legend: {
						position: "nw"
					},
					series: {
						lines: { show: true },
						points: { show: true }
					},
					xaxis: {
						show: false
					},
					yaxis: {
						show: false,
						min: 5000,
						//max: 30000,
						tickDecimals: 1
					},
					grid: {
						//backgroundColor: { colors: [ "#fff", "#eee" ] },
						clickable: true,
						hoverable: true,
						borderWidth: {
							top: 1,
							right: 1,
							bottom: 2,
							left: 2
						}
					}
				});			

			$("#throughput-chart").bind("plothover", function (event, pos, item) {				
					if (item) {
						var x = item.datapoint[0].toFixed(2),
							y = item.datapoint[1].toFixed(2);

						$("#tooltip").html(item.series.label + " of " + x + " = " + y)
							.css({top: item.pageY+5, left: item.pageX+5})
							.fadeIn(200);
					} else {
						$("#tooltip").hide();
					}
			});

		});
});

</script>
</head>
<body>

	<div id="header">
		<h2>ROAR Viewer</h2>
		<h5 id="details"></h5>
	</div>

	<div id="content">
		<div class="demo-container2">
			<div id="throughput-chart" class="demo-placeholder"></div>						
		</div>

		<div class="demo-container2">
			<div id="latency-chart" class="demo-placeholder"></div>						
		</div>

		<div class="demo-container2">
			<div id="cpu-memory-chart" class="demo-placeholder"></div>			
		</div>

		<div class="demo-container2">
			<div id="io-chart" class="demo-placeholder"></div>
		</div>		
	</div>

	<div id="footer">
		Copyright 2014 Magnum @ Vanderbilt University
	</div>

</body>
</html>
